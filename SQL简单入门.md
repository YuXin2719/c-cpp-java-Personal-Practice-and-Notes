# 一、MYSQL简介

MySQL是一种关系型数据库管理系统（**注意，它是管理系统，不只是数据库**）

安装过程本笔记不过多介绍，详情可以在b站、CSDN等网站查询



# 二、MySQL-Shell的使用

MySQL-Shell是一个交互式的JavaScript Python和SQL的终端，可以用于执行数据库管理任务

它提供了自动语法高亮，语法检查，自动完成和上下文感知的提示，从而提高了开发人员和DBA的生产力

MySQL-Shell是支持JS，Python和SQL三种语言的，默认使用JS

MySQL-Shell比较适合用来做一些数据库管理工作，它可以通过编写一些日常经常重复使用到的脚本来提高工作效率，比如备份数据库，管理集群等等



# 三、SQL基础

**RDBMS（关系型数据库管理系统）**和**NON-RDBMS（非关系型数据库管理系统）**是两种不同的数据库管理系统



**RDBMS采用了关系模型来组织数据**

**MySQL就是RDBMS类型的**

借助于集合，代数等数学概念和方法来处理数据

通过二维表来表示数据之间的联系，二维表的每一行表示一条数据记录，每一列表示一个字段，也就是记录的某个属性，不同的表之间通过关联字段来建立联系，这种关联关系就是关系型数据库管理系统的特点

<img src="photo/image-20241110151519727.png" alt="image-20241110151519727" style="zoom:50%;" />



**非关系型管理系统（NON-RDBMS）是对关系型数据库管理系统（RDBMS）的补充和拓展**

由于互联网快速发展，仅仅使用关系型数据库已经不能满足需求了，比如各种短视频、流媒体、地理位置信息、社交网络等等，这些数据的特点是数据量大，数据结构复杂，数据类型多种多样，这就决定了RDBMS不能很好的处理这些数据，因此出现了NON-RDBMS

常见的NON-RDBMS有以下这些：

<img src="photo/image-20241110152154559.png" alt="image-20241110152154559" style="zoom:33%;" />



**SQL是一种用来操作关系型数据库的语言**

RDBMS中数据一般是以表的形式来存储的，SQL可以用来操作表中的数据，几乎所有RDBMS都支持SQL

我们可以在MySQL的客户端命令行中执行SQL语句，也可以在可视化的GUI工具，比如Workbench或者Navicat中执行这些语句

一般来说，SQL语句**不区分大小写**，但是为了提高可读性，我们一般会把关键字大写，把表名、列名和其他名称小写

**按照功能不同，SQL语句可以分为以下几类：**

| 缩写 | 名称                                    | 相关的关键字                  |
| ---- | --------------------------------------- | ----------------------------- |
| DDL  | 数据定义语言 Data Definition Language   | CREATE、DROP、ALTER、TRUNCATE |
| DML  | 数据操作语言 Data Manipulation Language | INSERT、UPDATE、DELETE、CALL  |
| DQL  | 数据查询语言 Data Query Language        | SELECT、WHRER                 |
| DCL  | 数据控制语言 Data Control Language      | GRANT、REVOKE                 |



# 四、创建数据库

可以在MySQL的命令行客户端或者GUI工具中，执行一个CREATE DATABASE语句，来创建一个数据库

注意：在进行以上操作之前，最好将MySQL添加到系统环境变量，这里不做介绍

<img src="photo/image-20241110160735636.png" alt="image-20241110160735636" style="zoom:50%;" />

1. `show databases;`：查看当前已经存在的数据库

   <img src="photo/image-20241110161101909.png" alt="image-20241110161101909" style="zoom:50%;" />

   可以看到现在我有4个数据库

2. 然后我们来创建一个名字叫做game的数据库，在命令行输入`CREATE DATABASE game;`回车创建完成

   <img src="photo/image-20241110163839601.png" alt="image-20241110163839601" style="zoom:50%;" />

   使用`show databases;`查看一下是否创建成功

   <img src="photo/image-20241110163946284.png" alt="image-20241110163946284" style="zoom:50%;" />



# 五、创建表

有了数据库之后，我们就可以在数据库中创建表了

1. 在创建表之前，我们需要先使用use语句选择一个数据库

   比如我们现在选择game数据库

   <img src="photo/image-20241110164343907.png" alt="image-20241110164343907" style="zoom:50%;" />

2. 然后使用create语句来建表（从这里开始以下的代码使用MySQL Workbench执行）

   create后面加一个table关键字再加表的名称，最后加上一对括号，括号中是字段的名称和数据类型，字段之间用逗号隔开，最后一个字段不需要加逗号

   比如我们要做的游戏需要一个玩家表，表中需要包含玩家的ID、名字、等级、经验、金币等信息

   那么就可以输入：CREATE + TABLE关键字 + 表的名称比如player + 一对括号，括号中包含：

   - 玩家的ID，整数
   - 玩家名字，字符串，大小是100个字符
   - 等级，整数
   - 经验值，整数
   - 金钱，十进制数值

   <img src="photo/image-20241110173817038.png" alt="image-20241110173817038" style="zoom:50%;" />

   **这里就涉及到MySQL的数据类型**

   MySQL中的数据类型大致分为五大类别：

   1. **数值类型**
   2. **日期和时间类型**
   3. **字符串类型**
   4. **JSON类型（新增）**
   5. **空间类型（新增）**

   每种类型也都包括一些不同的子类型，我们可以根据需要来选择

   

   1. 比如数值类型包括整数类型和浮点数类型

      整数类型根据占用的存储空间不同，又包括TINYINT、SMALLINT、INT和BIGINT，分别对应1-8个字节的存储空间，可以存储不同范围的整数

      浮点数类型包括Float和Double，分别对应4个字节和8个字节的存储空间，可以存储不同范围的浮点数

   2. 日期和时间类型包括DATE、TIME、DATETIME和TIMESTAMP，分别对应日期，时间，日期时间和时间戳

   3. 字符串类型包括CHAR、VARCHAR、TEXT和BLOB等等，分别对应定长字符串，变长字符串，文本和二进制数据，比如我们刚才定义的VARCHAR（100）就代表长度为100的变长字符串，而DECIMAL（10,2）就表示长度为10，并且保留两位小数的十进制数值

   4. 比较新的版本的MySQL还支持JSON类型以及点、线、多边形等几何空间类型

   

3. 创建好表之后我们可以使用DESC语句来查看表的结构，DESC是describe的缩写，意思是描述，用来描述表的结构，比如如果想查看刚刚创建的player表的结构，就可以输入DESC后面加上表名player，然后点击执行

   <img src="photo/image-20241110173848220.png" alt="image-20241110173848220" style="zoom:50%;" />

   在执行结果中就可以看到表的结构，包括表中每一列的名称，数据类型，是否允许为空，默认值等等

   

4. 如果我们创建表的时候，发现表结构有问题，需要修改的话，那么就可以使用ALTER语句来修改表的结构

   比如我们发现玩家名字的长度可能不够，需要修改为更长的长度，ALTER跟上TABLE关键字和表名，然后跟上MODIFY COLUMN关键字，表示修改列，然后跟上想要修改的列名和新的数据类型

   然后我们再查看一下新的表结构

   <img src="photo/image-20241110174859395.png" alt="image-20241110174859395" style="zoom:50%;" />

   

   除了数据类型之外，字段名称也是可以修改的，比如我们可以把name这一列改成nick_name昵称

   那么可以输入ALTER TABLE关键字，后面加上表名player，然后再加上一个RENAME COLUMN关键字，表示重命名字段，后面加上旧的字段名和一个TO关键字，最后加上我们想要修改的新的字段名nick_name

   然后再查看一下表结构

   <img src="photo/image-20241110175647619.png" alt="image-20241110175647619" style="zoom:50%;" />

   

   除了修改列的名称和数据类型之外，也可以使用ADD COLUMN来添加一个新的字段，比如我们就来添加一个玩家最后登录的时间

   那么就可以输入ALTER TABLE player，后面加上ADD COLUMN关键字，然后加上想要添加的字段名last_login，最后是一个datetime的数据类型

   然后再查看一下表的结构

   <img src="photo/image-20241110180300439.png" alt="image-20241110180300439" style="zoom:50%;" />

   

   可以添加字段的话，当然也可以使用 DROP COLUMN来删除一个字段，比如我们把刚添加的last_login字段再删除掉，只需要输入ALTER TABLE player，后面加上一个DROP COLUMN关键字，最后加上想要删除的字段就可以了

   然后我们再查看一下表结构

   <img src="photo/image-20241110180630424.png" alt="image-20241110180630424" style="zoom:50%;" />

   

   最后如果我们想要删除整个表的话，可以使用DROP TABLE语句，比如来删除刚刚创建的player表的话

   只需要输入DROP TABLE加上表名player，执行就可以了

   ![image-20241110182959334](photo/image-20241110182959334.png)



以上就是创建和管理表的一些基本操作



# 六、数据的增删改查

到目前为止，我们已经学会了如何创建数据库和表，一句如何来修改他们的结构，这节课我们来看一下如何对表中的数据进行一些常用的操作



1. 首先还是创建一个玩家表

   <img src="photo/image-20241110183400432.png" alt="image-20241110183400432" style="zoom:50%;" />

2. INSERT插入数据：创建完成之后，我们向这个表中插入一条数据

   可以使用INSERT语句，他的语法结构是这样的，首先是一个INSERT INTO关键字，后面跟上表的名称，然后是括号括起来的列的名称，再用VALUES关键字，后面加上具体的值就可以了

   如果表名后面的括号中包括了所有的列，并且顺序也和表结构保持一致的话，那么这个括号以及它里面的列名就都可以省略掉，直接在表名后面加上VALUES关键字，然后加上值就可以了

   也可以只写上部分列的名称，这样没有列出来的部分，就会使用我们在建表时设置的默认值来填充

   <img src="photo/image-20241110184438011.png" alt="image-20241110184438011" style="zoom:50%;" />

3. 然后可以使用SELECT语句查看一下数据

   SELECT后面跟上要查询的列名，也可以使用一个星号来代替所有的列，然后跟上FROM关键字和想要查询的表名，表示从哪个表来查询数据，然后来执行以下这条语句，就可以看到我们插入的数据了

   <img src="photo/image-20241110184738465.png" alt="image-20241110184738465" style="zoom:50%;" />

   INSERT也可以插入多条数据，直接在VALUES后面加上多组数据就可以了，数据之间用逗号隔开

   插入后查询数据

   <img src="photo/image-20241110193654386.png" alt="image-20241110193654386" style="zoom:50%;" />

   这里有很多null，是因为我们在创建表的时候没有指定默认值，那默认就会是一个null，表示一个空值

   这样显然不是很合理，比如一般游戏中玩家等级都是从1级开始

   那我们就可以修改一下表结构，把等级的默认值改为1

   使用ALTER TABLE关键字，后面加上表的名称，然后加上一个MODIFY，然后是字段的名称和类型，最后加上一个DEFAULT 1表示默认值是1级

   然后再来插入一条数据，执行之后再来查看一下数据

   <img src="photo/image-20241110195318780.png" alt="image-20241110195318780" style="zoom:50%;" />

   可以看到，后面最后插入的曹操记录虽然没有指定他的等级，但是已经默认赋值为1了

   

   除了默认值之外，还可以使用NULL或者NOT NULL来指定这个字段是否允许为空值

   或者使用UNIQUE来制定这个字段必须是唯一的

   这些都是一种约束，用来保证数据的正确性和完整性

   

   经常用到的约束有以下几种：

   除了上面提到的默认值、非空和唯一约束之外，还有主键约束和外键约束等等

   - 主键约束用来保证数据的唯一性，不为空，并且每个表只能有1个主键

   - 外键约束用来保证数据的一致性，一个表的外键必须是另一个表的主键

   

4. UPDATE修改数据：我们之前插入的赵六和王五同学的等级还是NULL

   我们可以使用UPDATA语句来修改一下他们的等级

   UPDATE语句后面跟上表的名称，然后用set关键字加上要修改的列名和值，后面跟上一个WHERE条件字句，表示要修改哪些数据，比如把赵六同学的等级修改成1级，就可以在WHERE后面指定name为赵六，这样就可以把赵六同学的等级修改成1级了

   <img src="photo/image-20241110202708064.png" alt="image-20241110202708064" style="zoom:50%;" />

   用同样的方法修改一下王五和李二的等级吧

   <img src="photo/image-20241110203128921.png" alt="image-20241110203128921" style="zoom:50%;" />

   

   这样所有玩家的等级的都是1级了，但是后面的经验和金币还是NULL

   如果也像刚才那样一条一条修改的话，显然是非常麻烦的

   其实是可以**一次性修改所有的数据**的

   只要把后面的WHERE条件子句去掉就可以了，这样就会把所有的数据都修改掉

   比如我们要把所有玩家的经验和金钱都修改成0的话

   我们可以用UPDATE关键字加上表名player和关键字set再加上想要设置的字段名称和值就可以了，如果有多个字段的话，中间可以用逗号隔开

   我们执行一下，看结果

   <img src="photo/image-20241110203654849.png" alt="image-20241110203654849" style="zoom:50%;" />

   可以看到所有玩家的经验和金钱都修改成0了

   **但是这里需要提醒大家：在实际开发中，不加WHERE条件是非常危险的行为，尤其是在执行UPDATE或者DELETE语句的时候**

   

5. DELETE删除数据：我们可以使用DELETE语句，后面跟上表名，然后使用WHERE条件子句来指定要删除哪些数据，比如我们要删除所有金钱为0的玩家，就可以在WHERE条件子句后面指定gold等于0

   然后再来查看一下数据

   <img src="photo/image-20241110204220423.png" alt="image-20241110204220423" style="zoom:50%;" />

   这样所有的玩家都被删除了



# 七、数据的导入和导出

有的时候我们需要对数据库执行一些导入和导出的操作，方便我们对数据进行备份，或者将数据从一个库迁移到另一个库中，这里我提前找到了一些数据库文件，里面包含了以后需要使用的一些数据

数据的导入导出可以使用命令来完成，也可以在图形化界面直接操作



**我们首先看一下命令行的方式**

可以使用mysqldump来导出数据

`mysqldump -u root -p game > game.sql `

-u 指定用户名，-p 指定密码，后面加上数据库的名称和表的名称，表的名称可以省略，如果省略就会导出整个数据库的所有数据

最后再加上一个大于号和文件名来表示将数据导出到这个文件中

比如我们来导出一下game数据库中的数据

使用cmd执行，不用打开进入SQL，会直接导出到cmd当前的文件夹中，例如我现在导出到桌面文件夹中

然后用type命令显示文件内容

<img src="photo/image-20241113211420111.png" alt="image-20241113211420111" style="zoom:50%;" />

可以看到里面就是一条条的SQL语句，这些语句就是用来创建表以及插入数据的

这样我们就可以将这个文件分享给其他人，就可以直接导入到自己的数据库中了



接下来我们来看一下如何导入数据

由于后续的课程中，会涉及到一些复杂的SQL语句，会对数据有一些要求，这里也提前准备好了一份数据，刚好趁着这个机会来导入一下，这样后面的课程中就可以直接使用了

<img src="photo/image-20241113212029301.png" alt="image-20241113212029301" style="zoom:50%;" />

我们先用dir命令看一下这个文件夹内存在的文件

<img src="photo/image-20241113212105196.png" alt="image-20241113212105196" style="zoom:50%;" />

导入数据使用的是mysql命令：`mysql -u root -p game < game.sql`

输入mysql之后，后面一样也跟上-u指定用户名，然后是-p参数指定密码，然后是数据库的名称，最后再加上一个小于号和文件名

<img src="photo/image-20241113212322581.png" alt="image-20241113212322581" style="zoom:50%;" />

如果没有错误提示的话，导入就完成了，我们打开图形化工具查询一下

<img src="photo/image-20241113212513369.png" alt="image-20241113212513369" style="zoom:50%;" />



# 八、常用语句

## 1.where 子句

WHERE子句用来提取那些满足指定标准的记录

他可以同SELECT、UPDATE和DELETE一起使用

比如查找所有等级为1的玩家，就可以在WHERE后面加上条件level=1即可

<img src="photo/image-20241113212817866.png" alt="image-20241113212817866" style="zoom:50%;" />

除了等号之外，还有其他的比较运算符都可以使用，比如大于、小于、大于等于、小于等于、不等于等等



有的时候我们需要查找满足多个条件的数据

比如查找等级大于1并且小于5的玩家，就可以使用AND来连接这两个条件

WHERE后面加上第一个条件level>1，然后再加上一个AND，在加上一个条件level<5

结果如下：

<img src="photo/image-20241113213210908.png" alt="image-20241113213210908" style="zoom:50%;" />

同样的，我们如果想查找经验大于1小于5的玩家，更改属性名即可

<img src="photo/image-20241113213313097.png" alt="image-20241113213313097" style="zoom:50%;" />



除了AND以外，还有OR和NOT这两个逻辑运算符

需要注意的是，如果同时使用他们的话，是需要注意一下他们的优先级的

优先级顺序是 NOT>AND>OR

比如我们想查找等级大于1小于5或者经验大于1小于5的玩家，就可以把上面两条AND语句用OR来连接起来

这样就可以把刚刚的两个查询结果合并起来了

<img src="photo/image-20241113214010065.png" alt="image-20241113214010065" style="zoom:50%;" />

我们也可以使用括号来改变优先级

比如使用括号把中间的两个条件括起来的话，那么就会先执行中间括号中的OR条件，然后在执行两边的AND条件

<img src="photo/image-20241113214233855.png" alt="image-20241113214233855" style="zoom:50%;" />



## 2.IN 指定多个值

如果我们想查找多个不同等级的玩家，就可以使用IN来指定多个值

比如查找等级为1,3,5的玩家的话，就可以在WHERE条件后面加上一个IN，然后在括号中指定1,3,5这三个值，中间使用逗号隔开

<img src="photo/image-20241113214714681.png" alt="image-20241113214714681" style="zoom:50%;" />

IN还经常会和子查询一起使用，这个后面再详细讲解



## 3.BETWEEN...AND...

可以使用BETWEEN和AND来指定一个连续的范围

比如我们想查找等级在1和10之间的玩家，就可以在WHERE条件后面加上一个level字段，然后使用BETWEEN和AND来指定一个范围，比如1到10，就可以查找等级在1到10之间的玩家了，包括1和10

<img src="photo/image-20241113215027777.png" alt="image-20241113215027777" style="zoom:50%;" />

这条语句也等价于level大于等于1并且小于等于10



## 4.NOT 取反

我们可以在条件语句的掐年来表示取反

比如刚刚的条件前面加上NOT的话，就表示等级不在1到10之间的玩家了

NOT可以加在任何一个条件语句前面，比如我们刚刚执行过的IN，或者是各种比较运算符都可以

<img src="photo/image-20241113220010804.png" alt="image-20241113220010804" style="zoom:50%;" />

## 5.LIKE 模糊查询

有的时候我们需要进行一些模糊查询

比如查找姓王的玩家或者名字里包含王的玩家，这个时候可以LIKE来查找

LIKE后面加上一个用来匹配的模式，模式中可以使用下面两种通配符：

- %：任意个字符
- _：任意一个字符

比如查找姓王的玩家的话，就可以在WHERE条件后面加上一个name LIKE，然后使用一对单引号把王括起来，后面加上一个百分号，这表示的是名字中第一个字是王，后面可以是任意多个字符的玩家

<img src="photo/image-20241113221145089.png" alt="image-20241113221145089" style="zoom:50%;" />



而如果我们想要查找名字中包含王字的玩家，就可以在王的前面加上一个百分号，表示前面也有可能是任意多个字符，这样就可以查找到名字中包含王的玩家了

<img src="photo/image-20241113221347237.png" alt="image-20241113221347237" style="zoom:50%;" />



如果我们想查找姓王，但是名字只有两个字的玩家呢

这个时候就可以使用下划线来匹配一个字符，这样结果中就只剩下王五一个了

<img src="photo/image-20241113221514164.png" alt="image-20241113221514164" style="zoom:50%;" />



## 6.REGEXP 正则表达式

有时候我们需要查找的模式比较复杂，就可以使用REGEXP来匹配正则表达式

正则表达式中可以使用通配符来定义匹配规则，可以使用的通配符包括以下这些：

（常用通配符）

- .：任意一个字符
- ^：开头
- $：结尾
- [abc]：其中任意一个字符
- [a-z]：范围内的任意一个字符
- A|B：A或者B

例如，我们想查找姓王并且名字只有两个字的玩家

WHERE后面加上一个字段name，然后是表示使用正则表达式的关键字REGEXP，后面加上一个我们想要的正则表达式就可以了

<img src="photo/image-20241113222358486.png" alt="image-20241113222358486" style="zoom:50%;" />

这里的^表示开头，$表示结尾，.表示匹配任意一个字符



那如果想查找名字中包含王字的玩家呢，那就只留下王字，其他都去掉就可以了

<img src="photo/image-20241113222600609.png" alt="image-20241113222600609" style="zoom:50%;" />

注意这里并不需要加上%或者_，正则表达式中没有这两个通配符，只有LIKE中才有



如果想查找名字中包含王或者张的玩家，就是用中括号把王和张括起来，表示匹配其中任意一个字符，这样只要名字中包含王或者张的玩家

<img src="photo/image-20241113223130472.png" alt="image-20241113223130472" style="zoom:50%;" />



另外一种方式是使用竖线来表示或者，可以把中括号去掉，然后在王和张之间加上一个竖线

<img src="photo/image-20241113223244426.png" alt="image-20241113223244426" style="zoom: 50%;" />

和上面中括号的方式结果是一样的



## 7.NULL 空值

有时候我们需要查找某个列的值是空的数据

这时，注意不能使用等号来判断

正确的做法是使用IS NULL来判断

<img src="photo/image-20241113223524064.png" alt="image-20241113223524064" style="zoom:50%;" />



同样，我们想查找填写了邮箱的玩家，就可以使用IS NOT NULL来判断

<img src="photo/image-20241113223613564.png" alt="image-20241113223613564" style="zoom:50%;" />



MySQL还提供了一个专门用来比较NULL值的比较操作符

就是在等号两边加上尖括号把它括起来

这样也是可以查找到邮箱为NULL的玩家的

**但是我还是推荐大家使用IS NULL来判断**

<img src="photo/image-20241113223749928.png" alt="image-20241113223749928" style="zoom:50%;" />



还有一点需要注意的是，有的时候数据库中的数据是一个空字符串，表面上看它和NULL都是空吗，但实际上它们也是不一样的

NULL需要使用IS NULL来判断，而空字符串应该使用等号来判断

看一下例子，这里还是查询一下没有填写邮箱的玩家

<img src="photo/image-20241113224819898.png" alt="image-20241113224819898" style="zoom:50%;" />

这里可以找到两条记录，邮箱存在空值和空字符串两种情况

NULL表示没有值，空字符串表示填写一个空的值



## 8.ORDER BY 排序

ORDER BY用来对查询结果按照某个字段来进行排序

如果不指定的话，默认是升序排序

比如想要按照等级从小到大的顺序来把玩家排列起来，就可以在查询语句后面加上一个ORDER BY，然后指定一个列的名称，比如这里就用等级level，这样就可以按照等级升序排列了

<img src="photo/image-20241113225740749.png" alt="image-20241113225740749" style="zoom:50%;" />
